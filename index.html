<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulasi Mancing RNG</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      padding: 20px 24px;
      max-width: 640px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid #1e293b;
    }

    h1 { font-size: 1.5rem; margin-bottom: 4px; }
    .subtitle { font-size: 0.85rem; color: #9ca3af; margin-bottom: 16px; }
    label { display: block; font-size: 0.9rem; margin-top: 10px; margin-bottom: 4px; }

    input, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }

    button {
      margin-top: 14px;
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #0b1120;
      font-weight: 600;
      cursor: pointer;
    }

    .results {
      margin-top: 16px;
      font-size: 0.9rem;
      background: #020617;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid #1e293b;
      max-height: 300px;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.85rem;
    }

    th, td {
      padding: 4px 6px;
      border-bottom: 1px solid #111827;
    }

    .tag {
      display: inline-block;
      background: #0f172a;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      margin: 2px;
      border: 1px solid #1e293b;
    }

    .tag-target { border-color: #38bdf8; }
    .tag-rare { border-color: #22c55e; }
    .muted { color: #9ca3af; }
  </style>
</head>

<body>
  <div class="card">
    <h1>Simulasi Mancing RNG</h1>
    <div class="subtitle">Test Hoki Lu Disini Dasar Luck Issue</div>

    <label>Luck (%)</label>
    <input id="luckInput" type="number" value="0" min="0" />

    <label>Stop ketika dapat rarity:</label>
    <select id="targetSelect"></select>

    <label>Batas maksimal caught (opsional):</label>
    <input id="maxAttemptsInput" type="text" value="20M" />

    <button id="runBtn">üé£ Time Skip & Simulasikan</button>

    <div class="results" id="results">
      <p class="muted">Klik tombol untuk simulasi.</p>
    </div>
  </div>

  <script>
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1445708442185764915/rKYKWkugQOQxngy0NyDI8f61E5sn5ysRrmHY13IVWpS6gZkP-8Nb54iV00uBPRwIg2ee";

    function sendToDiscord(payload) {
      fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
    }

    // Kirim log saat website dibuka (embed + waktu WIB)
    (function() {
      const nowWib = new Date().toLocaleString("id-ID", {
        timeZone: "Asia/Jakarta",
        hour12: false
      });

      sendToDiscord({
        embeds: [{
          title: "üåê Website Dibuka",
          color: 0x3b82f6,
          description: "Seseorang membuka website simulasi.",
          fields: [
            {
              name: "Waktu (WIB)",
              value: nowWib + " WIB",
              inline: false
            }
          ],
          timestamp: new Date().toISOString()
        }]
      });
    })();

    const RARITIES = [
      { key: "5m", label: "1 in 5,000,000", denom: 5000000 },
      { key: "4m", label: "1 in 4,000,000", denom: 4000000 },
      { key: "3_5m", label: "1 in 3,500,000", denom: 3500000 },
      { key: "3m", label: "1 in 3,000,000", denom: 3000000 },
      { key: "2m", label: "1 in 2,000,000", denom: 2000000 },
      { key: "1_5m", label: "1 in 1,500,000", denom: 1500000 },
      { key: "1m", label: "1 in 1,000,000", denom: 1000000 },
      { key: "800k", label: "1 in 800,000", denom: 800000 },
      { key: "750k", label: "1 in 750,000", denom: 750000 },
      { key: "450k", label: "1 in 450,000", denom: 450000 },
      { key: "200k", label: "1 in 200,000", denom: 200000 }
    ];

    const targetSelect = document.getElementById("targetSelect");
    RARITIES.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r.key;
      opt.textContent = r.label;
      if (r.key === "4m") opt.selected = true;
      targetSelect.appendChild(opt);
    });

    function getRarityByKey(key) {
      return RARITIES.find(r => r.key === key);
    }

    function randomCastTime() {
      return 4 + Math.random() * 2;
    }

    function formatTime(sec) {
      sec = Math.floor(sec);
      const days = Math.floor(sec / 86400);
      sec %= 86400;
      const hours = Math.floor(sec / 3600);
      const minutes = Math.floor((sec % 3600) / 60);
      if (days >= 1) return `${days} hari ${hours} jam`;
      return `${hours} jam ${minutes} menit`;
    }

    function parseMaxInput(val) {
      return val.toUpperCase().includes("M")
        ? parseInt(val) * 1000000
        : parseInt(val);
    }

    function castOnce(multiplier) {
      let chosen = null;
      for (const rarity of RARITIES) {
        const prob = Math.min((1 / rarity.denom) * multiplier, 1);
        if (Math.random() < prob) {
          if (!chosen || rarity.denom > chosen.denom) chosen = rarity;
        }
      }
      return chosen;
    }

    document.getElementById("runBtn").addEventListener("click", () => {
      const luck = parseFloat(document.getElementById("luckInput").value || 0);
      const multiplier = 1 + luck / 100;
      const targetKey = targetSelect.value;
      const targetRarity = getRarityByKey(targetKey);
      const maxRaw = document.getElementById("maxAttemptsInput").value;
      const maxAttempts = parseMaxInput(maxRaw);

      const counts = {};
      const timeAtCatch = {};
      RARITIES.forEach(r => counts[r.key] = 0);

      let totalTime = 0;
      let attempts = 0;
      let gotTarget = false;

      while (!gotTarget && attempts < maxAttempts) {
        attempts++;
        totalTime += randomCastTime();
        const caught = castOnce(multiplier);
        if (caught) {
          counts[caught.key]++;
          if (!timeAtCatch[caught.key]) timeAtCatch[caught.key] = totalTime;
          if (caught.key === targetKey) gotTarget = true;
        }
      }

      let html = "";
      const status = gotTarget ? "DAPAT ‚úÖ" : "TIDAK DAPAT ‚ùå";

      if (gotTarget) {
        html += `<p>‚úÖ Target <b>${targetRarity.label}</b> didapat dalam <b>${attempts.toLocaleString()}</b> caught</p>`;
        html += `<p>‚è±Ô∏è Total waktu: <b>${formatTime(totalTime)}</b></p>`;
      } else {
        html += `<p>‚ö†Ô∏è Target belum didapat sampai batas caught</p>`;
      }

      html += `<p class="muted">Luck multiplier: ${multiplier.toFixed(2)}x</p>`;

      html += `<p>Rarity yang sempat ke-catch:</p>`;
RARITIES.forEach(r => {
  if (counts[r.key] > 0) {
    let desc = "";

    if (r.key === targetKey) {
      desc = "target";
    } else if (r.denom > targetRarity.denom) {
      desc = "lebih langka";
    } else {
      desc = "lebih mudah";
    }

    html += `<span class="tag ${r.key === targetKey ? "tag-target" : ""}">
      ${r.label} ‚Üí ${counts[r.key]}x (${formatTime(timeAtCatch[r.key])}) 
      <span class="muted">(${desc})</span>
    </span>`;
  }
});

      document.getElementById("results").innerHTML = html;

      // webhook hasil simulasi: embed + waktu WIB di paling bawah
      const nowWib = new Date().toLocaleString("id-ID", {
        timeZone: "Asia/Jakarta",
        hour12: false
      });

      sendToDiscord({
        embeds: [{
          title: "üéØ SIMULASI DITEKAN",
          color: gotTarget ? 0x22c55e : 0xef4444,
          fields: [
            {
              name: "Luck",
              value: `${luck}% (x${multiplier.toFixed(2)})`,
              inline: true
            },
            {
              name: "Target",
              value: targetRarity.label,
              inline: true
            },
            {
              name: "Batas Maksimal",
              value: maxRaw,
              inline: true
            },
            {
              name: "Hasil",
              value: status,
              inline: false
            },
            {
              name: "Total Caught",
              value: attempts.toLocaleString(),
              inline: true
            },
            {
              name: "Total Waktu",
              value: formatTime(totalTime),
              inline: true
            },
            {
              name: "Waktu (WIB)",
              value: nowWib + " WIB",
              inline: false
            }
          ],
          timestamp: new Date().toISOString(),
          footer: {
            text: "Simulasi Mancing RNG"
          }
        }]
      });
    });
  </script>
</body>
</html>
