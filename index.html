<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Simulasi Mancing RNG</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      padding: 20px 24px;
      max-width: 640px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid #1e293b;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-top: 10px;
      margin-bottom: 4px;
    }

    input, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }

    button {
      margin-top: 14px;
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #0b1120;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.95rem;
    }

    button:active {
      transform: translateY(1px);
      filter: brightness(0.9);
    }

    .results {
      margin-top: 16px;
      font-size: 0.9rem;
      background: #020617;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid #1e293b;
      max-height: 260px;
      overflow: auto;
    }

    .results p {
      margin: 4px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.85rem;
    }

    th, td {
      padding: 4px 6px;
      text-align: left;
      border-bottom: 1px solid #111827;
    }

    th {
      font-weight: 600;
      color: #9ca3af;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #0f172a;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      margin-right: 4px;
      margin-bottom: 4px;
      border: 1px solid #1e293b;
    }

    .tag-rare {
      border-color: #22c55e;
      color: #bbf7d0;
    }

    .tag-target {
      border-color: #38bdf8;
      color: #e0f2fe;
    }

    .muted {
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Simulasi Mancing RNG</h1>
    <div class="subtitle">
      Test hoki kamu untuk berbagai rarity (1 in X) dengan luck% custom.
    </div>

    <label for="luckInput">
      Luck (%) &mdash; misalnya 0, 50, 100 (disimulasi sebagai pengali chance)
    </label>
    <input
      id="luckInput"
      type="number"
      value="0"
      step="1"
      min="0"
      placeholder="misalnya 50 untuk +50% luck"
    />

    <label for="targetSelect">
      Stop ketika dapat rarity (1 in ...):
    </label>
    <select id="targetSelect"></select>

    <label for="maxAttemptsInput">
      Batas maksimal caught (biar browser nggak nge-freeze) &mdash; opsional
    </label>
    <input
      id="maxAttemptsInput"
      type="number"
      value="20000000"
      step="100000"
      min="1"
    />

    <button id="runBtn">üé£ Time Skip & Simulasikan</button>

    <div class="results" id="results">
      <p class="muted">Klik "Time Skip & Simulasikan" buat lihat hasil.</p>
    </div>
  </div>

  <script>
    // List rarity dari yang paling langka ke yang paling mudah
    const RARITIES = [
      { key: "5m", label: "1 in 5,000,000", denom: 5000000 },
      { key: "4m", label: "1 in 4,000,000", denom: 4000000 },
      { key: "3_5m", label: "1 in 3,500,000", denom: 3500000 },
      { key: "3m", label: "1 in 3,000,000", denom: 3000000 },
      { key: "2m", label: "1 in 2,000,000", denom: 2000000 },
      { key: "1_5m", label: "1 in 1,500,000", denom: 1500000 },
      { key: "1m", label: "1 in 1,000,000", denom: 1000000 },
      { key: "800k", label: "1 in 800,000", denom: 800000 },
      { key: "750k", label: "1 in 750,000", denom: 750000 },
      { key: "450k", label: "1 in 450,000", denom: 450000 },
      { key: "250k", label: "1 in 250,000", denom: 250000 }
    ];

    const targetSelect = document.getElementById("targetSelect");
    const luckInput = document.getElementById("luckInput");
    const maxAttemptsInput = document.getElementById("maxAttemptsInput");
    const runBtn = document.getElementById("runBtn");
    const resultsDiv = document.getElementById("results");

    // Isi dropdown target rarity
    RARITIES.forEach((r, index) => {
      const opt = document.createElement("option");
      opt.value = r.key;
      opt.textContent = r.label;
      // default: stop di 1 in 4m (bisa diganti)
      if (r.key === "4m") opt.selected = true;
      targetSelect.appendChild(opt);
    });

    function getRarityByKey(key) {
      return RARITIES.find((r) => r.key === key);
    }

    function formatNumber(n) {
      return n.toLocaleString("en-US");
    }

    // Simulasi 1 cast
    // Di sini kita asumsikan:
    // - Tiap rarity punya chance independen (1 / denom * multiplier)
    // - Kalau lebih dari 1 "kena" sekaligus, kita ambil yang PALING LANGKA (denom terbesar)
    function castOnce(multiplier) {
      let chosen = null;

      for (const rarity of RARITIES) {
        const baseProb = 1 / rarity.denom;
        const effectiveProb = Math.min(baseProb * multiplier, 1);

        if (Math.random() < effectiveProb) {
          if (!chosen || rarity.denom > chosen.denom) {
            chosen = rarity;
          }
        }
      }

      return chosen; // bisa null (nggak dapat rare)
    }

    function simulate() {
      const luckPercent = parseFloat(luckInput.value || "0");
      const multiplier = 1 + (isNaN(luckPercent) ? 0 : luckPercent / 100);

      const targetKey = targetSelect.value;
      const targetRarity = getRarityByKey(targetKey);
      if (!targetRarity) {
        alert("Target rarity tidak valid.");
        return;
      }

      let maxAttempts = parseInt(maxAttemptsInput.value || "0", 10);
      if (isNaN(maxAttempts) || maxAttempts <= 0) {
        maxAttempts = 20000000; // default safety
      }

      // Inisialisasi counter per rarity
      const counts = {};
      RARITIES.forEach((r) => {
        counts[r.key] = 0;
      });

      let attempts = 0;
      let gotTarget = false;

      // Simulasi ‚Äútime skip‚Äù: loop sampai dapat target atau sampai batas cast
      while (!gotTarget && attempts < maxAttempts) {
        attempts++;
        const caught = castOnce(multiplier);
        if (caught) {
          counts[caught.key]++;

          if (caught.key === targetKey) {
            gotTarget = true;
          }
        }
      }

      // Bangun teks hasil
      const lines = [];

      if (gotTarget) {
        lines.push(
          `<p>‚úÖ <b>Berhasil dapat ${targetRarity.label}</b> setelah <b>${formatNumber(
            attempts
          )}</b> cast.</p>`
        );
      } else {
        lines.push(
          `<p>‚ö†Ô∏è <b>Belum dapat ${targetRarity.label}</b> setelah mencapai batas <b>${formatNumber(
            attempts
          )}</b> cast.</p>`
        );
      }

      lines.push(
        `<p class="muted">Luck multiplier: <b>${multiplier.toFixed(
          2
        )}x</b> (dari ${luckPercent || 0}% luck).</p>`
      );

      // Tag cepat: apa aja yang sempat ke-catch
      const caughtSomething = RARITIES.filter((r) => counts[r.key] > 0);
      if (caughtSomething.length === 0) {
        lines.push(`<p>Tidak ada dari list rarity ultra-rare yang ke-catch.</p>`);
      } else {
        let tagHtml = "";
        for (const r of caughtSomething) {
          const isTarget = r.key === targetKey;
          const isRarer = r.denom > targetRarity.denom; // denom lebih besar = lebih langka
          const extraClass = isTarget
            ? "tag-target"
            : isRarer
            ? "tag-rare"
            : "";
          const labelExtra = isTarget
            ? "target"
            : isRarer
            ? "lebih langka"
            : "lebih mudah";

          tagHtml += `<span class="tag ${extraClass}">
              ${r.label}
              <span class="muted">(${labelExtra})</span>
            </span>`;
        }
        lines.push(`<p>Rarity yang sempat ke-catch:</p>`);
        lines.push(`<p>${tagHtml}</p>`);
      }

      // Tabel detail semua rarity
      let tableHtml = `
        <table>
          <thead>
            <tr>
              <th>Rarity</th>
              <th>Denom</th>
              <th>Jumlah Caught</th>
            </tr>
          </thead>
          <tbody>
      `;

      for (const r of RARITIES) {
        const count = counts[r.key];
        tableHtml += `
          <tr>
            <td>${r.label}${
          r.key === targetKey ? ' <span class="muted">(target)</span>' : ""
        }</td>
            <td>1 in ${formatNumber(r.denom)}</td>
            <td>${formatNumber(count)}</td>
          </tr>
        `;
      }

      tableHtml += `</tbody></table>`;

      lines.push(tableHtml);

      resultsDiv.innerHTML = lines.join("");
    }

    runBtn.addEventListener("click", simulate);
  </script>
</body>
</html>